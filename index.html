<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hip Rafter Calculator</title>
    <style>
        :root {
            --primary-color: #2D3436;
            --primary-dark: #1e2527;
            --background-color: #ffffff;
            --section-bg: #f8f9fa;
            --text-color: #2D3436;
            --border-radius: 16px;
            --spacing: 32px;
            --accent-color: #00b894;
            --error-color: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 60px 20px;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.75rem;
            font-weight: 800;
            margin-bottom: calc(var(--spacing) * 1.5);
            text-align: center;
            letter-spacing: -0.5px;
            color: var(--primary-color);
        }

        .calculator-section {
            background-color: var(--section-bg);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing) * 1.25);
            margin-bottom: var(--spacing);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                       0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .input-group {
            margin-bottom: var(--spacing);
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            color: var(--primary-color);
            background: #f8f9fa;
            transition: all 0.3s ease;
            font-weight: 500;
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 184, 148, 0.1);
        }

        input[type="number"]::placeholder {
            color: #a0aec0;
        }

        .number-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .number-input-container::after {
            content: attr(data-unit);
            position: absolute;
            right: 16px;
            color: var(--accent-color);
            font-weight: 500;
            font-size: 0.9rem;
            pointer-events: none;
        }

        .number-input-container input[type="number"] {
            padding-right: 40px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 10px 0;
            position: relative;
        }

        .slider-container input[type="range"] {
            flex: 1;
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            margin-top: -10px;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .slider-container input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            border: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0 8px rgba(0, 184, 148, 0.1);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        .slider-value {
            min-width: 70px;
            padding: 8px 16px;
            background: var(--accent-color);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 184, 148, 0.2);
        }

        .results-section {
            background-color: var(--section-bg);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing) * 1.25);
            margin-top: var(--spacing);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                       0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .result-item {
            margin-bottom: 15px;
            padding: 16px;
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
        }

        .result-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
        }

        .result-content > div:last-child {
            color: #666;
            white-space: nowrap;
        }

        .result-item span:first-child {
            color: var(--text-color);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .result-item span:last-child {
            font-weight: 600;
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .conversion-display {
            background-color: var(--section-bg);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 8px 16px;
            margin-top: 8px;
            font-size: 0.95rem;
            color: var(--primary-color);
            font-weight: 500;
        }

        .number-input-container {
            position: relative;
        }

        .number-input-container[data-unit]::after {
            content: attr(data-unit);
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
            font-weight: 500;
        }

        .number-input-container[data-unit] input {
            padding-right: 48px;
        }

        .number-input-container[data-unit] .conversion-display {
            padding-right: 48px;
        }

        .total-rise-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .total-rise-input {
            flex: 2;
        }

        .total-rise-equals {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--primary-color);
            margin: 0 4px;
        }

        .total-rise-conversion {
            flex: 1;
            min-width: 120px;
        }

        @media (max-width: 600px) {
            body {
                padding: 40px 16px;
            }

            h1 {
                font-size: 2rem;
            }

            .calculator-section,
            .results-section {
                padding: var(--spacing);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hip Rafter Calculator</h1>
        
        <div class="calculator-section">
            <h2>Plan View</h2>
            <div class="input-group">
                <label for="buildingLength">Building Length (ft)</label>
                <div class="number-input-container" data-unit="ft">
                    <input type="number" id="buildingLength" step="0.125" placeholder="Enter length" oninput="updateSpan()">
                </div>
            </div>
            <div class="input-group">
                <label for="buildingWidth">Building Width (ft)</label>
                <div class="number-input-container" data-unit="ft">
                    <input type="number" id="buildingWidth" step="0.125" placeholder="Enter width" oninput="updateSpan()">
                </div>
            </div>
            <div class="input-group">
                <label for="rafterSpacing">Rafter Spacing</label>
                <div class="number-input-container" data-unit='" O.C.'>
                    <input type="number" id="rafterSpacing" step="0.25">
                </div>
            </div>
        </div>

        <div class="calculator-section">
            <h2>Calculations</h2>
            <div class="input-group">
                <label for="slope">Slope (X in 12):</label>
                <div class="slider-container">
                    <input type="range" id="slope" min="2" max="12" step="1" value="12">
                    <div class="slider-value" id="slope-value">12/12</div>
                </div>
            </div>
            <div class="input-group">
                <label for="span">Span (ft)</label>
                <div class="number-input-container" data-unit="ft">
                    <input type="number" id="span" step="0.125" placeholder="Auto-calculated" readonly>
                </div>
            </div>
            <div class="input-group">
                <label for="totalRun">Total Run (ft)</label>
                <div class="number-input-container" data-unit="ft">
                    <input type="number" id="totalRun" step="0.125" placeholder="Auto-calculated" readonly>
                </div>
            </div>
            <div class="input-group">
                <label for="unitRise">Unit Rise</label>
                <div class="number-input-container">
                    <input type="number" id="unitRise" placeholder="Auto-calculated" readonly>
                </div>
            </div>
            <div class="input-group">
                <label for="totalRise">Total Rise (in)</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit="inch">
                        <input type="number" id="totalRise" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="totalRiseFtIn"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="ridgeBoard">Ridge Board (ft)</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit="ft">
                        <input type="number" id="ridgeBoard" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="ridgeBoardFtIn"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="ucr">UCR:</label>
                <div class="number-input-container" data-unit="">
                    <input type="number" id="ucr" step="0.001" placeholder="UCR will auto-populate" readonly>
                </div>
            </div>
            <div class="input-group">
                <label for="llcr">LLCR (ft)</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit="ft">
                        <input type="number" id="llcr" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="llcrFtIn"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="commonDifference">Common Difference</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit='"'>
                        <input type="number" id="commonDifference" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="commonDifferenceFraction"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="llhjr1">LLHJR#1</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit='"'>
                        <input type="number" id="llhjr1" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="llhjr1FtIn"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="llhjr2">LLHJR#2</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit='"'>
                        <input type="number" id="llhjr2" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="llhjr2FtIn"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="llhjr3">LLHJR#3</label>
                <div class="total-rise-container">
                    <div class="number-input-container total-rise-input" data-unit='"'>
                        <input type="number" id="llhjr3" placeholder="Auto-calculated" readonly>
                    </div>
                    <span class="total-rise-equals">=</span>
                    <div class="number-input-container total-rise-conversion">
                        <div class="conversion-display" id="llhjr3FtIn"></div>
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label for="uhr">UHR:</label>
                <div class="number-input-container" data-unit="">
                    <input type="number" id="uhr" step="0.001" placeholder="UHR will auto-populate" readonly>
                </div>
            </div>
            <div class="input-group">
                <label for="hipRafterThickness">Hip Rafter Thickness (inches):</label>
                <div class="slider-container">
                    <input type="range" id="hipRafterThickness" min="0.5" max="3" step="0.125" value="1.5">
                    <div class="slider-value" id="thickness-value">1 1/2"</div>
                </div>
            </div>
            <div class="input-group">
                <label for="projection">Projection (inches):</label>
                <div class="slider-container">
                    <input type="range" id="projection" min="0" max="12" step="0.5" value="6">
                    <div class="slider-value" id="projection-value">6"</div>
                </div>
            </div>
            <div class="input-group">
                <label for="fasciaThickness">Fascia Thickness (inches):</label>
                <div class="slider-container">
                    <input type="range" id="fasciaThickness" min="0" max="3" step="0.5" value="0.5">
                    <div class="slider-value" id="fasciaThickness-value">1/2"</div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <h2>Results For Hip Rafter</h2>
            <div class="results-container" id="results">
                <div class="result-item">
                    <div class="result-content">
                        <span>LLHR:</span>
                        <span id="llhrResult">-</span>
                    </div>
                </div>
                <div class="result-item">
                    <div class="result-content">
                        <span>Bird Mouth Reference Line:</span>
                        <span id="birdMouthResult">-</span>
                    </div>
                </div>
                <div class="result-item">
                    <div class="result-content">
                        <span>Projection Line Length:</span>
                        <span id="projectionResult">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uhrValues = {
            2: 17.09,
            3: 17.23,
            4: 17.44,
            5: 17.69,
            6: 18.00000000000001,
            7: 18.36,
            8: 18.76,
            9: 19.21,
            10: 19.70,
            11: 20.22,
            12: 20.78
        };

        const ucrValues = {
            2: 12.16,
            3: 12.37,
            4: 12.65,
            5: 13.00,
            6: 13.42,
            7: 13.89,
            8: 14.42,
            9: 15.00,
            10: 15.62,
            11: 16.28,
            12: 16.97
        };

        // Function to update Span based on building dimensions
        function updateSpan() {
            const widthInput = document.getElementById('buildingWidth');
            const spanInput = document.getElementById('span');
            
            if (widthInput.value) {
                // Span equals the building width
                const width = parseFloat(widthInput.value);
                spanInput.value = width;
                updateTotalRun();
                updateRidgeBoard();
            } else {
                spanInput.value = '';
                updateTotalRun();
                updateRidgeBoard();
            }
        }

        // Function to update Total Run based on Span
        function updateTotalRun() {
            const spanInput = document.getElementById('span');
            const totalRunInput = document.getElementById('totalRun');
            
            if (spanInput.value) {
                // Calculate total run as half of span (both in feet)
                const totalRun = parseFloat(spanInput.value) / 2;
                totalRunInput.value = totalRun;
                updateTotalRise();
                updateLLCR();
                performCalculations();
            } else {
                totalRunInput.value = '';
                updateTotalRise();
                updateLLCR();
            }
        }

        // Function to convert inches to feet and inches
        function inchesToFeetInches(inches) {
            const feet = Math.floor(inches / 12);
            const remainingInches = (inches % 12).toFixed(2);
            return `${feet}' ${remainingInches}"`;
        }

        // Function to convert decimal to fraction with specific denominators
        function decimalToFraction(decimal, denominators = [2, 4, 8, 12, 16]) {
            if (decimal === 0) return "0";
            
            let bestNumerator = 0;
            let bestDenominator = 1;
            let minDiff = Number.MAX_VALUE;
            
            // Try each denominator
            for (const denominator of denominators) {
                const numerator = Math.round(decimal * denominator);
                const diff = Math.abs(decimal - numerator / denominator);
                
                if (diff < minDiff) {
                    minDiff = diff;
                    bestNumerator = numerator;
                    bestDenominator = denominator;
                }
            }
            
            // Simplify the fraction
            const gcd = (a, b) => b ? gcd(b, a % b) : a;
            const divisor = gcd(Math.abs(bestNumerator), bestDenominator);
            bestNumerator = bestNumerator / divisor;
            bestDenominator = bestDenominator / divisor;
            
            // Convert to mixed number if numerator is greater than denominator
            if (Math.abs(bestNumerator) >= bestDenominator) {
                const wholeNumber = Math.floor(Math.abs(bestNumerator) / bestDenominator);
                const remainingNumerator = Math.abs(bestNumerator) % bestDenominator;
                
                if (remainingNumerator === 0) {
                    return (bestNumerator < 0 ? "-" : "") + wholeNumber.toString();
                }
                
                return (bestNumerator < 0 ? "-" : "") + 
                       `${wholeNumber} ${remainingNumerator}/${bestDenominator}`;
            }
            
            if (bestDenominator === 1) {
                return bestNumerator.toString();
            }
            return `${bestNumerator}/${bestDenominator}`;
        }

        // Function to convert inches to feet and fraction inches for LLCR
        function inchesToFeetFraction(inches) {
            const feet = Math.floor(inches / 12);
            const remainingInches = Math.floor(inches % 12);
            const fractionalPart = inches % 1;
            let inchDisplay = '';
            
            if (fractionalPart === 0) {
                inchDisplay = remainingInches.toString();
            } else {
                const fraction = decimalToFraction(fractionalPart);
                if (remainingInches > 0) {
                    inchDisplay = `${remainingInches} ${fraction}`;
                } else {
                    inchDisplay = fraction;
                }
            }
            
            return `${feet}' ${inchDisplay}"`;
        }

        // Function to update Total Rise
        function updateTotalRise() {
            const totalRunInput = document.getElementById('totalRun');
            const unitRiseInput = document.getElementById('unitRise');
            const totalRiseInput = document.getElementById('totalRise');
            const totalRiseFtInDisplay = document.getElementById('totalRiseFtIn');

            if (totalRunInput.value && unitRiseInput.value) {
                // Convert total run from feet to inches
                const totalRunInches = parseFloat(totalRunInput.value) * 12;
                const unitRise = parseFloat(unitRiseInput.value);
                
                // Calculate total rise in inches
                const totalRiseInches = totalRunInches * (unitRise / 12);
                
                // Display total rise in inches
                totalRiseInput.value = totalRiseInches.toFixed(2);
                
                // Display conversion in feet and inches
                totalRiseFtInDisplay.textContent = inchesToFeetInches(totalRiseInches);
            } else {
                totalRiseInput.value = '';
                totalRiseFtInDisplay.textContent = '';
            }
        }

        // Function to update Ridge Board
        function updateRidgeBoard() {
            const lengthInput = document.getElementById('buildingLength');
            const widthInput = document.getElementById('buildingWidth');
            const ridgeBoardInput = document.getElementById('ridgeBoard');
            const ridgeBoardFtInDisplay = document.getElementById('ridgeBoardFtIn');

            if (lengthInput.value && widthInput.value) {
                const length = parseFloat(lengthInput.value);
                const width = parseFloat(widthInput.value);
                const ridgeBoardFt = length - width;
                
                // Display ridge board in feet
                ridgeBoardInput.value = ridgeBoardFt.toFixed(2);
                
                // Convert to feet and inches for the conversion display
                const ridgeBoardInches = ridgeBoardFt * 12;
                ridgeBoardFtInDisplay.textContent = inchesToFeetInches(ridgeBoardInches);
            } else {
                ridgeBoardInput.value = '';
                ridgeBoardFtInDisplay.textContent = '';
            }
        }

        // Function to update LLCR
        function updateLLCR() {
            const totalRunInput = document.getElementById('totalRun');
            const ucrInput = document.getElementById('ucr');
            const llcrInput = document.getElementById('llcr');
            const llcrFtInDisplay = document.getElementById('llcrFtIn');

            if (totalRunInput.value && ucrInput.value) {
                const totalRun = parseFloat(totalRunInput.value);
                const ucr = parseFloat(ucrInput.value);
                
                // Calculate LLCR in feet
                const llcrFt = totalRun * ucr / 12; // Divide by 12 since UCR is in inches
                
                // Display LLCR in feet
                llcrInput.value = llcrFt.toFixed(2);
                
                // Convert to feet and inches for the conversion display
                const llcrInches = llcrFt * 12;
                llcrFtInDisplay.textContent = inchesToFeetFraction(llcrInches);
                
                // Update LLHJR#1 after LLCR is calculated
                updateLLHJR1();
            } else {
                llcrInput.value = '';
                llcrFtInDisplay.textContent = '';
                updateLLHJR1();
            }
        }

        // Function to update Common Difference
        function updateCommonDifference() {
            const ucrInput = document.getElementById('ucr');
            const rafterSpacingInput = document.getElementById('rafterSpacing');
            const commonDifferenceInput = document.getElementById('commonDifference');
            const commonDifferenceFraction = document.getElementById('commonDifferenceFraction');

            if (ucrInput.value && rafterSpacingInput.value) {
                const ucr = parseFloat(ucrInput.value);
                const rafterSpacing = parseFloat(rafterSpacingInput.value);
                
                // Calculate Common Difference
                const commonDifference = ucr * rafterSpacing / 12;
                
                // Display the value
                commonDifferenceInput.value = commonDifference.toFixed(3);
                
                // Convert to fraction and display
                const fraction = decimalToFraction(commonDifference);
                commonDifferenceFraction.textContent = `${fraction}"`;
            } else {
                commonDifferenceInput.value = '';
                commonDifferenceFraction.textContent = '';
            }
            updateLLHJR1();
        }

        // Function to update LLHJR#1
        function updateLLHJR1() {
            const llcrInput = document.getElementById('llcr');
            const commonDifferenceInput = document.getElementById('commonDifference');
            const llhjr1Input = document.getElementById('llhjr1');
            const llhjr1FtInDisplay = document.getElementById('llhjr1FtIn');

            if (llcrInput.value && commonDifferenceInput.value) {
                // Convert LLCR from feet to inches
                const llcrInches = parseFloat(llcrInput.value) * 12;
                const commonDifference = parseFloat(commonDifferenceInput.value);
                
                // Calculate LLHJR#1 in inches
                const llhjr1Inches = llcrInches - commonDifference;
                
                // Display in inches for the main input
                llhjr1Input.value = llhjr1Inches.toFixed(3);
                
                // Display in feet and inches format for conversion
                llhjr1FtInDisplay.textContent = inchesToFeetFraction(llhjr1Inches);
                
                updateLLHJR2();
            } else {
                llhjr1Input.value = '';
                llhjr1FtInDisplay.textContent = '';
                updateLLHJR2();
            }
        }

        // Function to update LLHJR#2
        function updateLLHJR2() {
            const llhjr1Input = document.getElementById('llhjr1');
            const commonDifferenceInput = document.getElementById('commonDifference');
            const llhjr2Input = document.getElementById('llhjr2');
            const llhjr2FtInDisplay = document.getElementById('llhjr2FtIn');

            if (llhjr1Input.value && commonDifferenceInput.value) {
                const llhjr1Inches = parseFloat(llhjr1Input.value);
                const commonDifference = parseFloat(commonDifferenceInput.value);
                
                // Calculate LLHJR#2 in inches
                const llhjr2Inches = llhjr1Inches - commonDifference;
                
                // Display in inches for the main input
                llhjr2Input.value = llhjr2Inches.toFixed(3);
                
                // Display in feet and inches format for conversion
                llhjr2FtInDisplay.textContent = inchesToFeetFraction(llhjr2Inches);
                
                updateLLHJR3();
            } else {
                llhjr2Input.value = '';
                llhjr2FtInDisplay.textContent = '';
                updateLLHJR3();
            }
        }

        // Function to update LLHJR#3
        function updateLLHJR3() {
            const llhjr2Input = document.getElementById('llhjr2');
            const commonDifferenceInput = document.getElementById('commonDifference');
            const llhjr3Input = document.getElementById('llhjr3');
            const llhjr3FtInDisplay = document.getElementById('llhjr3FtIn');

            if (llhjr2Input.value && commonDifferenceInput.value) {
                const llhjr2Inches = parseFloat(llhjr2Input.value);
                const commonDifference = parseFloat(commonDifferenceInput.value);
                
                // Calculate LLHJR#3 in inches
                const llhjr3Inches = llhjr2Inches - commonDifference;
                
                // Display in inches for the main input
                llhjr3Input.value = llhjr3Inches.toFixed(3);
                
                // Display in feet and inches format for conversion
                llhjr3FtInDisplay.textContent = inchesToFeetFraction(llhjr3Inches);
            } else {
                llhjr3Input.value = '';
                llhjr3FtInDisplay.textContent = '';
            }
        }

        // Function to convert decimal to fraction
        function decimalToFraction(decimal) {
            if (decimal === 0) return "0";
            
            let bestNumerator = 0;
            let bestDenominator = 1;
            let minDiff = Number.MAX_VALUE;
            
            // Try each denominator
            for (const denominator of [16, 12, 8, 4, 2]) {
                const numerator = Math.round(decimal * denominator);
                const diff = Math.abs(decimal - numerator / denominator);
                
                if (diff < minDiff) {
                    minDiff = diff;
                    bestNumerator = numerator;
                    bestDenominator = denominator;
                }
            }
            
            // Simplify the fraction
            const gcd = (a, b) => b ? gcd(b, a % b) : a;
            const divisor = gcd(Math.abs(bestNumerator), bestDenominator);
            bestNumerator = bestNumerator / divisor;
            bestDenominator = bestDenominator / divisor;
            
            // Convert to mixed number if numerator is greater than denominator
            if (Math.abs(bestNumerator) >= bestDenominator) {
                const wholeNumber = Math.floor(Math.abs(bestNumerator) / bestDenominator);
                const remainingNumerator = Math.abs(bestNumerator) % bestDenominator;
                
                if (remainingNumerator === 0) {
                    return (bestNumerator < 0 ? "-" : "") + wholeNumber.toString();
                }
                
                return (bestNumerator < 0 ? "-" : "") + 
                       `${wholeNumber} ${remainingNumerator}/${bestDenominator}`;
            }
            
            if (bestDenominator === 1) {
                return bestNumerator.toString();
            }
            return `${bestNumerator}/${bestDenominator}`;
        }

        // Function to convert inches to feet and inches
        function inchesToFeetInches(inches) {
            const feet = Math.floor(inches / 12);
            const remainingInches = (inches % 12).toFixed(2);
            return `${feet}' ${remainingInches}"`;
        }

        // Initialize slope value display
        const slopeSlider = document.getElementById('slope');
        const slopeValue = document.getElementById('slope-value');
        const unitRiseInput = document.getElementById('unitRise');
        const thicknessSlider = document.getElementById('hipRafterThickness');
        const thicknessValue = document.getElementById('thickness-value');
        const projectionSlider = document.getElementById('projection');
        const projectionValue = document.getElementById('projection-value');
        const fasciaSlider = document.getElementById('fasciaThickness');
        const fasciaValue = document.getElementById('fasciaThickness-value');

        // Update slope value display when slider moves
        slopeSlider.addEventListener('input', function() {
            const value = this.value;
            slopeValue.textContent = value + '/12';
            unitRiseInput.value = value;
            const uhrInput = document.getElementById('uhr');
            const ucrInput = document.getElementById('ucr');
            if (uhrValues[this.value]) {
                uhrInput.value = uhrValues[this.value];
                ucrInput.value = ucrValues[this.value];
                updateLLCR();
                updateCommonDifference();
            }
            updateTotalRise();
            performCalculations();
        });

        // Update thickness value display when slider moves
        thicknessSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const formatted = formatFraction(value);
            thicknessValue.textContent = formatted + '"';
            performCalculations();
        });

        // Update projection value display when slider moves
        projectionSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const formatted = formatFraction(value);
            projectionValue.textContent = formatted + '"';
            performCalculations();
        });

        // Update fascia thickness value display when slider moves
        fasciaSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const formatted = formatFraction(value);
            fasciaValue.textContent = formatted + '"';
            performCalculations();
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize values
            const uhrInput = document.getElementById('uhr');
            const ucrInput = document.getElementById('ucr');
            if (uhrValues[slopeSlider.value]) {
                uhrInput.value = uhrValues[slopeSlider.value];
                ucrInput.value = ucrValues[slopeSlider.value];
            }

            // Initialize values for sliders
            const thicknessFormatted = formatFraction(thicknessSlider.value);
            thicknessValue.textContent = thicknessFormatted + '"';
            
            const projectionFormatted = formatFraction(projectionSlider.value);
            projectionValue.textContent = projectionFormatted + '"';

            const fasciaFormatted = formatFraction(fasciaSlider.value);
            fasciaValue.textContent = fasciaFormatted + '"';

            // Add input validation to prevent negative numbers
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', (e) => {
                    if (e.target.value < 0) {
                        e.target.value = Math.abs(e.target.value);
                    }
                    performCalculations();
                });
            });

            // Add event listeners for real-time calculation
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                slider.addEventListener('input', performCalculations);
            });

            document.getElementById('span').addEventListener('input', performCalculations);
            document.getElementById('buildingLength').addEventListener('input', updateRidgeBoard);
            document.getElementById('rafterSpacing').addEventListener('input', updateCommonDifference);
        });

        function getInputValue(id) {
            const element = document.getElementById(id);
            if (!element || !element.value) return 0;
            const value = parseFloat(element.value);
            return isNaN(value) ? 0 : value;
        }

        function calculateLLHR(totalRun, uhr, hipRafterThickness, slope) {
            if (!totalRun || !uhr || !hipRafterThickness || !slope) return 0;
            
            // Basic LLHR calculation
            const llhr = totalRun * (uhr/12);
            
            // No additional adjustment needed as the formula should be simple:
            // LLHR = Total Run × UHR ÷ 12
            return llhr;
        }

        function calculateBirdMouthHAP(llhr, hipRafterThickness) {
            if (!llhr || !hipRafterThickness) return 0;
            // Bird Mouth Reference Line = LLHR - (Hip Rafter Thickness ÷ 2)
            return llhr - (hipRafterThickness / 2);
        }

        function calculateProjectionLine(projection, fasciaThickness) {
            if (!projection || !fasciaThickness) return 0;
            // Projection Line Length = (Projection - Fascia Thickness) × 1.4142
            return (projection - fasciaThickness) * 1.4142;
        }

        function performCalculations() {
            // Get input values
            const totalRunFt = getInputValue('totalRun');
            const totalRunInches = totalRunFt * 12; // Convert feet to inches for calculations
            const slope = getInputValue('slope');
            const hipRafterThickness = getInputValue('hipRafterThickness');
            const projection = getInputValue('projection');
            const fasciaThickness = getInputValue('fasciaThickness');

            // Get UHR value based on slope
            const uhr = uhrValues[slope];

            if (totalRunFt && uhr && hipRafterThickness !== null) {
                const llhr = calculateLLHR(totalRunInches, uhr, hipRafterThickness, slope);
                const birdMouthHAP = calculateBirdMouthHAP(llhr, hipRafterThickness);
                const projectionLine = calculateProjectionLine(projection, fasciaThickness);

                displayResults({
                    llhr,
                    birdMouthHAP,
                    projectionLine
                });
            }
        }

        function displayResults(data) {
            const llhrResult = document.getElementById('llhrResult');
            const birdMouthResult = document.getElementById('birdMouthResult');
            const projectionResult = document.getElementById('projectionResult');

            // Format LLHR result
            const llhrFormatted = formatAllFractions(data.llhr);
            llhrResult.innerHTML = `<div>${generateResultHTML('LLHR', data.llhr, llhrFormatted)}</div>` + 
                                 `<div>= ${inchesToFeetFraction(data.llhr)}</div>`;

            // Format Bird Mouth HAP result
            const birdMouthHAPFormatted = formatAllFractions(data.birdMouthHAP);
            birdMouthResult.innerHTML = `<div>${generateResultHTML('Bird Mouth Reference Line', data.birdMouthHAP, birdMouthHAPFormatted)}</div>` + 
                                      `<div>= ${inchesToFeetFraction(data.birdMouthHAP)}</div>`;

            // Format Projection Line result if applicable
            if (data.projectionLine) {
                const projectionLineFormatted = formatAllFractions(data.projectionLine);
                projectionResult.innerHTML = `<div>${generateResultHTML('Projection Line', data.projectionLine, projectionLineFormatted)}</div>` + 
                                          `<div>= ${inchesToFeetFraction(data.projectionLine)}</div>`;
            }
        }

        function generateResultHTML(label, value, formatted) {
            return `
                <div class="main-result">${formatted.mainResult} inches</div>
                <div class="decimal-value" style="color: #666; font-size: 0.9em">(Decimal: ${value.toFixed(3)})</div>
                <div class="approximations" style="font-size: 0.85em; margin-top: 8px;">
                    <details>
                        <summary style="color: #666; cursor: pointer;">Show all approximations</summary>
                        <div style="margin-top: 4px; padding-left: 12px;">
                            ${formatted.allApproximations.map(approx => 
                                `<div style="margin: 2px 0;">${approx}</div>`
                            ).join('')}
                        </div>
                    </details>
                </div>
            `;
        }

        // Calculate Greatest Common Divisor (GCD)
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b) {
                const temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        // Simplify fraction
        function simplifyFraction(numerator, denominator) {
            if (numerator === 0) {
                return { numerator: 0, denominator: 1 };
            }
            const divisor = gcd(numerator, denominator);
            return {
                numerator: numerator / divisor,
                denominator: denominator / divisor
            };
        }

        function findClosestFraction(decimal) {
            const denominators = [16, 12, 8, 4, 2];
            let bestError = Infinity;
            let bestFraction = { whole: 0, numerator: 0, denominator: 1, error: Infinity };

            // Get the whole number part
            const whole = Math.floor(Math.abs(decimal));
            const fractionalPart = Math.abs(decimal) - whole;

            // Try each denominator
            for (const denominator of denominators) {
                // Find the closest numerator for this denominator
                const numerator = Math.round(fractionalPart * denominator);
                const approximation = numerator / denominator;
                const error = Math.abs(fractionalPart - approximation);

                if (error < bestError) {
                    bestError = error;
                    bestFraction = {
                        whole: whole,
                        numerator: numerator,
                        denominator: denominator,
                        originalNumerator: numerator,
                        originalDenominator: denominator,
                        error: error,
                        value: whole + approximation
                    };
                }
            }

            // Handle the case where the fraction is very close to 0 or 1
            if (bestFraction.numerator === 0) {
                return {
                    whole: whole,
                    numerator: 0,
                    denominator: 2,
                    originalNumerator: 0,
                    originalDenominator: 2,
                    error: bestError,
                    value: whole
                };
            }
            if (bestFraction.numerator === bestFraction.denominator) {
                return {
                    whole: whole + 1,
                    numerator: 0,
                    denominator: 2,
                    originalNumerator: 0,
                    originalDenominator: 2,
                    error: bestError,
                    value: whole + 1
                };
            }

            // Handle negative numbers
            if (decimal < 0) {
                bestFraction.whole = -bestFraction.whole;
                bestFraction.value = -bestFraction.value;
            }

            return bestFraction;
        }

        function formatAllFractions(number) {
            const fraction = findClosestFraction(number);
            let mainResult;
            
            if (fraction.numerator === 0) {
                mainResult = fraction.whole.toString();
            } else if (fraction.whole !== 0) {
                mainResult = `${fraction.whole} ${fraction.numerator}/${fraction.denominator}`;
            } else {
                mainResult = `${fraction.numerator}/${fraction.denominator}`;
            }

            // Generate all approximations with different denominators
            const denominators = [16, 12, 8, 4, 2];
            const allApproximations = denominators.map(denominator => {
                const numerator = Math.round((Math.abs(number) % 1) * denominator);
                const whole = Math.floor(Math.abs(number));
                const approximation = whole + numerator / denominator;
                const error = Math.abs(number - (number < 0 ? -approximation : approximation));
                
                let fractionText;
                if (numerator === 0) {
                    fractionText = whole.toString();
                } else if (whole !== 0) {
                    fractionText = `${whole} ${numerator}/${denominator}`;
                } else {
                    fractionText = `${numerator}/${denominator}`;
                }
                
                const errorPercent = (error * 100).toFixed(3);
                return `${fractionText} (error: ${errorPercent}%)`;
            });

            return {
                mainResult: mainResult,
                allApproximations: allApproximations,
                bestValue: fraction.value
            };
        }

        // Format decimal to fraction
        function formatFraction(decimal) {
            if (decimal === Math.floor(decimal)) {
                return decimal.toString();
            }

            // Convert to sixteenths (since step is 0.0625)
            const sixteenths = Math.round(decimal * 16);
            const wholePart = Math.floor(sixteenths / 16);
            const remainder = sixteenths % 16;

            if (remainder === 0) {
                return wholePart.toString();
            }

            // Simplify the fraction
            const [num, den] = simplifyFraction(remainder, 16);
            
            if (wholePart === 0) {
                return `${num}/${den}`;
            } else {
                return `${wholePart} ${num}/${den}`;
            }
        }

        // Simplify fraction by finding GCD
        function simplifyFraction(numerator, denominator) {
            function gcd(a, b) {
                return b === 0 ? a : gcd(b, a % b);
            }
            const divisor = gcd(numerator, denominator);
            return [numerator / divisor, denominator / divisor];
        }
    </script>
</body>
</html>
