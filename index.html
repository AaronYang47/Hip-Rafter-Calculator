<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hip Rafter Calculator</title>
    <style>
        :root {
            --primary-color: #2D3436;
            --primary-dark: #1e2527;
            --background-color: #ffffff;
            --section-bg: #f8f9fa;
            --text-color: #2D3436;
            --border-radius: 16px;
            --spacing: 32px;
            --accent-color: #00b894;
            --error-color: #d63031;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 60px 20px;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.75rem;
            font-weight: 800;
            margin-bottom: calc(var(--spacing) * 1.5);
            text-align: center;
            letter-spacing: -0.5px;
            color: var(--primary-color);
        }

        .calculator-section {
            background-color: var(--section-bg);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing) * 1.25);
            margin-bottom: var(--spacing);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                       0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .input-group {
            margin-bottom: var(--spacing);
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            color: var(--primary-color);
            background: #f8f9fa;
            transition: all 0.3s ease;
            font-weight: 500;
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 184, 148, 0.1);
        }

        input[type="number"]::placeholder {
            color: #a0aec0;
        }

        .number-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .number-input-container::after {
            content: attr(data-unit);
            position: absolute;
            right: 16px;
            color: var(--accent-color);
            font-weight: 500;
            font-size: 0.9rem;
            pointer-events: none;
        }

        .number-input-container input[type="number"] {
            padding-right: 40px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 10px 0;
            position: relative;
        }

        .slider-container input[type="range"] {
            flex: 1;
            width: 100%;
            -webkit-appearance: none;
            background: transparent;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            margin-top: -10px;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .slider-container input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            border: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0 8px rgba(0, 184, 148, 0.1);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(0.95);
        }

        .slider-value {
            min-width: 70px;
            padding: 8px 16px;
            background: var(--accent-color);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 184, 148, 0.2);
        }

        .results-section {
            background-color: var(--section-bg);
            border-radius: var(--border-radius);
            padding: calc(var(--spacing) * 1.25);
            margin-top: var(--spacing);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                       0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .result-item {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
        }

        .result-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .result-item span:first-child {
            color: var(--text-color);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .result-item span:last-child {
            font-weight: 600;
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        @media (max-width: 600px) {
            body {
                padding: 40px 16px;
            }

            h1 {
                font-size: 2rem;
            }

            .calculator-section,
            .results-section {
                padding: var(--spacing);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hip Rafter Calculator</h1>
        
        <div class="calculator-section">
            <h2>Bird Mouth Location</h2>
            <div class="input-group">
                <label for="totalRun">Total Run (inches)</label>
                <div class="number-input-container" data-unit="in">
                    <input type="number" id="totalRun" step="0.125" placeholder="Enter total run">
                </div>
            </div>
            <div class="input-group">
                <label for="slope">Slope (X in 12):</label>
                <div class="slider-container">
                    <input type="range" id="slope" min="2" max="12" step="1" value="12">
                    <div class="slider-value" id="slope-value">12/12</div>
                </div>
            </div>
            <div class="input-group">
                <label for="uhr">UHR:</label>
                <div class="number-input-container" data-unit="">
                    <input type="number" id="uhr" step="0.001" placeholder="UHR will auto-populate" readonly>
                </div>
            </div>
            <div class="input-group">
                <label for="hipRafterThickness">Hip Rafter Thickness (inches):</label>
                <div class="slider-container">
                    <input type="range" id="hipRafterThickness" min="0.5" max="3" step="0.125" value="1.5">
                    <div class="slider-value" id="thickness-value">1 1/2"</div>
                </div>
            </div>
            <div class="input-group">
                <label for="projection">Projection (inches):</label>
                <div class="slider-container">
                    <input type="range" id="projection" min="0" max="12" step="0.5" value="6">
                    <div class="slider-value" id="projection-value">6"</div>
                </div>
            </div>
            <div class="input-group">
                <label for="fasciaThickness">Fascia Thickness (inches):</label>
                <div class="slider-container">
                    <input type="range" id="fasciaThickness" min="0" max="3" step="0.5" value="0.5">
                    <div class="slider-value" id="fasciaThickness-value">1/2"</div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <h2>Results</h2>
            <div class="results-container" id="results">
                <div class="result-item">
                    <div class="result-content">
                        <span>Level Line Hip Rafter:</span>
                        <span id="llhrResult">-</span>
                    </div>
                </div>
                <div class="result-item">
                    <div class="result-content">
                        <span>Bird Mouth HAP:</span>
                        <span id="birdMouthResult">-</span>
                    </div>
                </div>
                <div class="result-item">
                    <div class="result-content">
                        <span>Projection Line Length:</span>
                        <span id="projectionResult">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uhrValues = {
            2: 17.09,
            3: 17.23,
            4: 17.44,
            5: 17.69,
            6: 18.00000000000001,
            7: 18.36,
            8: 18.76,
            9: 19.21,
            10: 19.70,
            11: 20.22,
            12: 20.78
        };

        // Initialize slope value display
        const slopeSlider = document.getElementById('slope');
        const slopeValue = document.getElementById('slope-value');
        const thicknessSlider = document.getElementById('hipRafterThickness');
        const thicknessValue = document.getElementById('thickness-value');
        const projectionSlider = document.getElementById('projection');
        const projectionValue = document.getElementById('projection-value');
        const fasciaSlider = document.getElementById('fasciaThickness');
        const fasciaValue = document.getElementById('fasciaThickness-value');

        // Update slope value display when slider moves
        slopeSlider.addEventListener('input', function() {
            slopeValue.textContent = this.value + '/12';
            const uhrInput = document.getElementById('uhr');
            if (uhrValues[this.value]) {
                uhrInput.value = uhrValues[this.value];
            }
            performCalculations();
        });

        // Update thickness value display when slider moves
        thicknessSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const formatted = formatFraction(value);
            thicknessValue.textContent = formatted + '"';
            performCalculations();
        });

        // Update projection value display when slider moves
        projectionSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const formatted = formatFraction(value);
            projectionValue.textContent = formatted + '"';
            performCalculations();
        });

        // Update fascia thickness value display when slider moves
        fasciaSlider.addEventListener('input', function() {
            const value = parseFloat(this.value);
            const formatted = formatFraction(value);
            fasciaValue.textContent = formatted + '"';
            performCalculations();
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize values
            const uhrInput = document.getElementById('uhr');
            if (uhrValues[slopeSlider.value]) {
                uhrInput.value = uhrValues[slopeSlider.value];
            }

            // Initialize values for sliders
            const thicknessFormatted = formatFraction(thicknessSlider.value);
            thicknessValue.textContent = thicknessFormatted + '"';
            
            const projectionFormatted = formatFraction(projectionSlider.value);
            projectionValue.textContent = projectionFormatted + '"';

            const fasciaFormatted = formatFraction(fasciaSlider.value);
            fasciaValue.textContent = fasciaFormatted + '"';

            // Add input validation to prevent negative numbers
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', (e) => {
                    if (e.target.value < 0) {
                        e.target.value = Math.abs(e.target.value);
                    }
                    performCalculations();
                });
            });

            // Add event listeners for real-time calculation
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                slider.addEventListener('input', performCalculations);
            });

            document.getElementById('totalRun').addEventListener('input', performCalculations);
        });

        function getInputValue(id) {
            const element = document.getElementById(id);
            if (!element || !element.value) return 0;
            const value = parseFloat(element.value);
            return isNaN(value) ? 0 : value;
        }

        function calculateLLHR(totalRun, uhr, hipRafterThickness, slope) {
            if (!totalRun || !uhr || !hipRafterThickness || !slope) return 0;
            
            // Basic LLHR calculation
            const llhr = totalRun * (uhr/12);
            
            // No additional adjustment needed as the formula should be simple:
            // LLHR = Total Run × UHR ÷ 12
            return llhr;
        }

        function calculateBirdMouthHAP(llhr, hipRafterThickness) {
            if (!llhr || !hipRafterThickness) return 0;
            // Bird Mouth Reference Line = LLHR - (Hip Rafter Thickness ÷ 2)
            return llhr - (hipRafterThickness / 2);
        }

        function calculateProjectionLine(projection, fasciaThickness) {
            if (!projection || !fasciaThickness) return 0;
            // Projection Line Length = (Projection - Fascia Thickness) × 1.4142
            return (projection - fasciaThickness) * 1.4142;
        }

        function performCalculations() {
            // Get input values
            const totalRun = parseFloat(document.getElementById('totalRun').value);
            const slope = parseFloat(document.getElementById('slope').value);
            const uhr = parseFloat(document.getElementById('uhr').value);
            const hipRafterThickness = parseFloat(document.getElementById('hipRafterThickness').value);
            const projectionLine = parseFloat(document.getElementById('projection').value) || 0;
            const fasciaThickness = parseFloat(document.getElementById('fasciaThickness').value) || 0;

            // Validate inputs
            if (!totalRun || !slope || !uhr || !hipRafterThickness) {
                alert('Please fill in all required fields');
                return;
            }

            // Calculate LLHR (Level Line Hip Rafter)
            const llhr = calculateLLHR(totalRun, uhr, hipRafterThickness, slope);

            // Calculate Bird Mouth Reference Line
            const birdMouthHAP = calculateBirdMouthHAP(llhr, hipRafterThickness);

            // Calculate Projection Line Length
            const projection = calculateProjectionLine(projectionLine, fasciaThickness);

            // Display results
            displayResults({
                totalRun,
                slope,
                llhr,
                birdMouthHAP,
                projection,
                hipRafterThickness,
                fasciaThickness
            });
        }

        function displayResults(data) {
            const llhrResult = document.getElementById('llhrResult');
            const birdMouthResult = document.getElementById('birdMouthResult');
            const projectionResult = document.getElementById('projectionResult');

            // Format LLHR result
            const llhrFormatted = formatAllFractions(data.llhr);
            llhrResult.innerHTML = generateResultHTML('LLHR', data.llhr, llhrFormatted);

            // Format Bird Mouth HAP result
            const birdMouthHAPFormatted = formatAllFractions(data.birdMouthHAP);
            birdMouthResult.innerHTML = generateResultHTML('Bird Mouth HAP', data.birdMouthHAP, birdMouthHAPFormatted);

            // Format Projection Line result if applicable
            if (data.projection) {
                const projectionLineFormatted = formatAllFractions(data.projection);
                projectionResult.innerHTML = generateResultHTML('Projection Line', data.projection, projectionLineFormatted);
            }
        }

        function generateResultHTML(label, value, formatted) {
            return `
                <div class="main-result">${formatted.mainResult} inches</div>
                <div class="decimal-value" style="color: #666; font-size: 0.9em">(Decimal: ${value.toFixed(3)})</div>
                <div class="approximations" style="font-size: 0.85em; margin-top: 8px;">
                    <details>
                        <summary style="color: #666; cursor: pointer;">Show all approximations</summary>
                        <div style="margin-top: 4px; padding-left: 12px;">
                            ${formatted.allApproximations.map(approx => 
                                `<div style="margin: 2px 0;">${approx}</div>`
                            ).join('')}
                        </div>
                    </details>
                </div>
            `;
        }

        // Calculate Greatest Common Divisor (GCD)
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b) {
                const temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        // Simplify fraction
        function simplifyFraction(numerator, denominator) {
            if (numerator === 0) {
                return { numerator: 0, denominator: 1 };
            }
            const divisor = gcd(numerator, denominator);
            return {
                numerator: numerator / divisor,
                denominator: denominator / divisor
            };
        }

        function findClosestFraction(decimal) {
            const denominators = [16, 12, 8, 4, 2];
            let bestError = Infinity;
            let bestFraction = { whole: 0, numerator: 0, denominator: 1, error: Infinity };

            // Get the whole number part
            const whole = Math.floor(Math.abs(decimal));
            const fractionalPart = Math.abs(decimal) - whole;

            // Try each denominator
            for (const denominator of denominators) {
                // Find the closest numerator for this denominator
                const numerator = Math.round(fractionalPart * denominator);
                const approximation = numerator / denominator;
                const error = Math.abs(fractionalPart - approximation);

                if (error < bestError) {
                    bestError = error;
                    bestFraction = {
                        whole: whole,
                        numerator: numerator,
                        denominator: denominator,
                        originalNumerator: numerator,
                        originalDenominator: denominator,
                        error: error,
                        value: whole + approximation
                    };
                }
            }

            // Handle the case where the fraction is very close to 0 or 1
            if (bestFraction.numerator === 0) {
                return {
                    whole: whole,
                    numerator: 0,
                    denominator: 2,
                    originalNumerator: 0,
                    originalDenominator: 2,
                    error: bestError,
                    value: whole
                };
            }
            if (bestFraction.numerator === bestFraction.denominator) {
                return {
                    whole: whole + 1,
                    numerator: 0,
                    denominator: 2,
                    originalNumerator: 0,
                    originalDenominator: 2,
                    error: bestError,
                    value: whole + 1
                };
            }

            // Handle negative numbers
            if (decimal < 0) {
                bestFraction.whole = -bestFraction.whole;
                bestFraction.value = -bestFraction.value;
            }

            return bestFraction;
        }

        function formatAllFractions(number) {
            const fraction = findClosestFraction(number);
            let mainResult;
            
            if (fraction.numerator === 0) {
                mainResult = fraction.whole.toString();
            } else if (fraction.whole !== 0) {
                mainResult = `${fraction.whole} ${fraction.numerator}/${fraction.denominator}`;
            } else {
                mainResult = `${fraction.numerator}/${fraction.denominator}`;
            }

            // Generate all approximations with different denominators
            const denominators = [16, 12, 8, 4, 2];
            const allApproximations = denominators.map(denominator => {
                const numerator = Math.round((Math.abs(number) % 1) * denominator);
                const whole = Math.floor(Math.abs(number));
                const approximation = whole + numerator / denominator;
                const error = Math.abs(number - (number < 0 ? -approximation : approximation));
                
                let fractionText;
                if (numerator === 0) {
                    fractionText = whole.toString();
                } else if (whole !== 0) {
                    fractionText = `${whole} ${numerator}/${denominator}`;
                } else {
                    fractionText = `${numerator}/${denominator}`;
                }
                
                const errorPercent = (error * 100).toFixed(3);
                return `${fractionText} (error: ${errorPercent}%)`;
            });

            return {
                mainResult: mainResult,
                allApproximations: allApproximations,
                bestValue: fraction.value
            };
        }

        // Format decimal to fraction
        function formatFraction(decimal) {
            if (decimal === Math.floor(decimal)) {
                return decimal.toString();
            }

            // Convert to sixteenths (since step is 0.0625)
            const sixteenths = Math.round(decimal * 16);
            const wholePart = Math.floor(sixteenths / 16);
            const remainder = sixteenths % 16;

            if (remainder === 0) {
                return wholePart.toString();
            }

            // Simplify the fraction
            const [num, den] = simplifyFraction(remainder, 16);
            
            if (wholePart === 0) {
                return `${num}/${den}`;
            } else {
                return `${wholePart} ${num}/${den}`;
            }
        }

        // Simplify fraction by finding GCD
        function simplifyFraction(numerator, denominator) {
            function gcd(a, b) {
                return b === 0 ? a : gcd(b, a % b);
            }
            const divisor = gcd(numerator, denominator);
            return [numerator / divisor, denominator / divisor];
        }
    </script>
</body>
</html>
